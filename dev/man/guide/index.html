<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>User Guide · InfrastructureSystems.jl</title><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit">InfrastructureSystems.jl</span></div><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li class="is-active"><a class="tocitem" href>User Guide</a><ul class="internal"><li><a class="tocitem" href="#Installation"><span>Installation</span></a></li><li><a class="tocitem" href="#Overview"><span>Overview</span></a></li><li><a class="tocitem" href="#Component-structs"><span>Component structs</span></a></li><li><a class="tocitem" href="#Logging"><span>Logging</span></a></li><li><a class="tocitem" href="#Recorder-events"><span>Recorder events</span></a></li></ul></li><li><span class="tocitem">API</span><ul><li><a class="tocitem" href="../../api/InfrastructureSystems/">InfrastructureSystems</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>User Guide</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>User Guide</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/NREL-SIIP/InfrastructureSystems.jl/blob/master/docs/src/man/guide.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="User-Guide"><a class="docs-heading-anchor" href="#User-Guide">User Guide</a><a id="User-Guide-1"></a><a class="docs-heading-anchor-permalink" href="#User-Guide" title="Permalink"></a></h1><h2 id="Installation"><a class="docs-heading-anchor" href="#Installation">Installation</a><a id="Installation-1"></a><a class="docs-heading-anchor-permalink" href="#Installation" title="Permalink"></a></h2><p>This package is not yet registered. <strong>Until it is, things may change. It is perfectly usable but should not be considered stable</strong>.</p><p>You can install it by typing</p><pre><code class="language-julia">julia&gt; Pkg.clone(&quot;https://github.com/NREL/InfrastructureSystems.jl.git&quot;)</code></pre><h2 id="Overview"><a class="docs-heading-anchor" href="#Overview">Overview</a><a id="Overview-1"></a><a class="docs-heading-anchor-permalink" href="#Overview" title="Permalink"></a></h2><p>InfrastructureSystems.jl provides utilities to support infrastructure modeling and simulations packages.  It is used primarily by <a href="https://github.com/NREL-SIIP/PowerSystems.jl">PowerSystems.jl</a> and <a href="https://github.com/NREL-SIIP/PowerSimulations.jl">PowerSimulations.jl</a> but is written to be extensible for other kinds of applications as well.</p><p>This document describes how to integrate it with other packages.</p><p><em>Note</em>: This is a work-in-progress and may not fully describe everything you need to know. You may need to refer to implementations in PowerSystems.jl and PowerSimulations.jl.</p><h2 id="Component-structs"><a class="docs-heading-anchor" href="#Component-structs">Component structs</a><a id="Component-structs-1"></a><a class="docs-heading-anchor-permalink" href="#Component-structs" title="Permalink"></a></h2><p>InfrastructureSystems provides a common way of managing component structs in a system.</p><h3 id="Type-hierachy"><a class="docs-heading-anchor" href="#Type-hierachy">Type hierachy</a><a id="Type-hierachy-1"></a><a class="docs-heading-anchor-permalink" href="#Type-hierachy" title="Permalink"></a></h3><p>Make every component a subtype of InfrastructureSystemsType.</p><h4 id="Interface-requirements"><a class="docs-heading-anchor" href="#Interface-requirements">Interface requirements</a><a id="Interface-requirements-1"></a><a class="docs-heading-anchor-permalink" href="#Interface-requirements" title="Permalink"></a></h4><p>Implement a <code>get_name(c::MyComponent)::String</code> method for every struct.</p><h3 id="InfrastructureSystemsInternal"><a class="docs-heading-anchor" href="#InfrastructureSystemsInternal">InfrastructureSystemsInternal</a><a id="InfrastructureSystemsInternal-1"></a><a class="docs-heading-anchor-permalink" href="#InfrastructureSystemsInternal" title="Permalink"></a></h3><p>Add this struct to every component struct.</p><ul><li>It automatically creates a UUID for the component. This guarantees a unique way to identify the component.</li><li>It optionally provides an extension dictionary for user data. A user extending your package may want to use your struct but need one more field. Rather than create a new type they can add data to this <code>ext</code> object.</li></ul><h4 id="Instructions"><a class="docs-heading-anchor" href="#Instructions">Instructions</a><a id="Instructions-1"></a><a class="docs-heading-anchor-permalink" href="#Instructions" title="Permalink"></a></h4><ol><li>Add the field to your struct. The constructor does not take any parameters.</li></ol><pre><code class="language-julia">struct MyComponent
    internal::InfrastructureSystemsInternal
end

# Optional
get_ext(c::MyComponent) = InfrastructureSystems.get_ext(c.ext)
clear_ext(c::MyComponent) = InfrastructureSystems.clear_ext(c.ext)</code></pre><p><em>Notes</em>:</p><ul><li><code>InfrastructureSystems.get_uuid(obj::InfrastructureSystemsType)</code> returns the component UUID.</li><li>The extension dictionary is not created until the first time <code>get_ext</code> is called.</li></ul><h3 id="Auto-Generation-of-component-structs"><a class="docs-heading-anchor" href="#Auto-Generation-of-component-structs">Auto-Generation of component structs</a><a id="Auto-Generation-of-component-structs-1"></a><a class="docs-heading-anchor-permalink" href="#Auto-Generation-of-component-structs" title="Permalink"></a></h3><p>InfrastructureSystems provides a mechanism to auto-generate Julia files containing structs and field accessor functions from JSON descriptors. Here are reasons to consider using this approach:</p><ul><li>Auto-generation allows for easy refactoring of code. Adding fields to many structs can be tedious because you might have to edit many constructors. This process eliminates boiler-plate edits.</li><li>The JSON descriptor format includes a mechanisim to define range validation on component fields. Validation can be enabled when adding components to a system.</li><li>Provides consistent formatting of structs, fields, and constructors.</li><li>Provides consistent documentation of structs and fields.</li></ul><h4 id="Instructions-2"><a class="docs-heading-anchor" href="#Instructions-2">Instructions</a><a class="docs-heading-anchor-permalink" href="#Instructions-2" title="Permalink"></a></h4><ol><li>Create the JSON descriptor file. Follow the <a href="https://github.com/NREL-SIIP/PowerSystems.jl/blob/master/src/descriptors/power_system_structs.json">PowerSystems.jl</a> example.</li><li>Run the generation script, passing your descriptor file and an output directory.</li></ol><pre><code class="language-julia">InfrastructureSystems.generate_structs(&quot;./src/descriptors/power_system_structs.json&quot;, &quot;./src/models/generated&quot;)</code></pre><p><em>Notes</em>:</p><ul><li>The code generation template provides several options which are not yet formally documented. Browse the PowerSystems example or the generation script.</li><li>You will need to decide how to manage the generated files. The PowerSystems package keeps the generated code in the git repository. This is not required. You could choose to generate them at startup.</li><li>You may need to create custom constructors and this approach will not allow you have put them in the same file as the struct definition.</li></ul><h3 id="Component-time-series-data"><a class="docs-heading-anchor" href="#Component-time-series-data">Component time series data</a><a id="Component-time-series-data-1"></a><a class="docs-heading-anchor-permalink" href="#Component-time-series-data" title="Permalink"></a></h3><p>InfrastructureSystems provides a mechanism to store time series data for components. Here are reasons to consider using it:</p><ul><li>Time series data, by default, is stored independently of components in HDF5 files. Components store references to that data.<ul><li>System memory is not depleted by loading all time series data at once. Only data that you need is loaded.</li><li>Multiple components can share the same time series data by sharing references instead of making expensive copies.</li></ul></li><li>Supports serialization and deserialization.</li><li>Supports parsing raw data files of several formats as well as data stored in <code>TimeSeries.TimeArray</code> and <code>DataFrames.DataFrame</code> objects.</li></ul><blockquote><p>:warning: <strong>You must reimplement deepcopy if you use HDF5</strong></p></blockquote><p>If you store an instance of <span>$SystemData$</span> within your system and then a user calls <span>$deepcopy$</span> on a system, the .h5 file will not be copied. The new and old instances will have references to the same file. You will need to reimplement <span>$deepcopy$</span> to handle this. One solution is to serialize and then deserialize the system.</p><p><em>Notes</em>:</p><ul><li>Time series data can optionally be stored fully in memory. Refer to the</li></ul><p><a href="https://nrel-siip.github.io/InfrastructureSystems.jl/latest/api/InfrastructureSystems/#InfrastructureSystems.SystemData-Tuple{AbstractString}">SystemData</a> documentation.</p><ul><li>InfrastructureSystems creates HDF5 files on the tmp filesystem by default. This can be changed if the time series data is larger than the amount of tmp space available. Refer to the <code>SystemData</code> link above.</li></ul><h4 id="Instructions-3"><a class="docs-heading-anchor" href="#Instructions-3">Instructions</a><a class="docs-heading-anchor-permalink" href="#Instructions-3" title="Permalink"></a></h4><ol><li>Add an instance of <code>InfrastructureSystems.Forecasts</code> to the component struct.</li><li>Implement the method <code>InfrastructureSystems.get_forecasts</code> for the component. It must return the Forecasts object.</li></ol><h3 id="Component-container"><a class="docs-heading-anchor" href="#Component-container">Component container</a><a id="Component-container-1"></a><a class="docs-heading-anchor-permalink" href="#Component-container" title="Permalink"></a></h3><p>InfrastructureSystems provides the <code>SystemData</code> struct to store a collection of components.</p><p>It is recommended but not required that you include this struct within your own   system struct for these reasons:</p><ul><li>Provides search and iteration with <code>get_component</code> and <code>get_components</code> for abstract and concrete types.</li><li>Enforces name uniqueness within a concrete type.</li><li>Allows for component field validation.</li><li>Enables component JSON serialization and deserialization.</li></ul><h4 id="Instructions-4"><a class="docs-heading-anchor" href="#Instructions-4">Instructions</a><a class="docs-heading-anchor-permalink" href="#Instructions-4" title="Permalink"></a></h4><ol><li>Add an instance of <code>SystemData</code> to your system struct.</li><li>Optionally pass a component validation descriptor file to the constructor.</li><li>Optionally pass <code>time_series_in_memory = true</code> to the constructor if you know that all time series data will fit in memory and want a performance boost.</li><li>Redirect these function calls to your instance of SystemData.<ul><li><code>add_component!</code></li><li><code>remove_component!</code></li><li><code>get_component</code></li><li><code>get_components</code></li><li><code>get_components_by_name</code></li><li><code>add_forecasts!</code></li><li><code>add_forecast!</code></li><li><code>remove_forecast!</code></li></ul></li></ol><h2 id="Logging"><a class="docs-heading-anchor" href="#Logging">Logging</a><a id="Logging-1"></a><a class="docs-heading-anchor-permalink" href="#Logging" title="Permalink"></a></h2><p>InfrastructureSystems provides a <code>MultiLogger</code> object that allows customized logging to console and file. Refer to the <a href="../logging/">logging documentation</a>.</p><p>If you want to create a package-specific log file during a simulation, consider the workflow used by PowerSimulations.jl. It creates a custom logger in its <code>build!(Simulation)</code> function and then uses Julia&#39;s <code>Logging.with_logger</code> function to temporarily take over the global logger during <code>build()</code> and <code>execute()</code>.</p><h2 id="Recorder-events"><a class="docs-heading-anchor" href="#Recorder-events">Recorder events</a><a id="Recorder-events-1"></a><a class="docs-heading-anchor-permalink" href="#Recorder-events" title="Permalink"></a></h2><p>InfrastructureSystems provides a mechanism to store structured data in events that get recorded in one or more files. They can be filtered and displayed in tabular form.</p><p>The primary use is to store information that can help debug problems.  For example, you may want to store all state transitions in a simulation or every update of a variable.  If a problem occurs you can then display filtered tables of that data to figure out what went wrong.</p><h3 id="Instructions-5"><a class="docs-heading-anchor" href="#Instructions-5">Instructions</a><a class="docs-heading-anchor-permalink" href="#Instructions-5" title="Permalink"></a></h3><ol><li>Create events that are subtypes of <code>InfrastructureSystems.AbstractRecorderEvent</code>. Include an instance of <code>RecorderEventCommon</code> in each struct.</li><li>Call <code>InfrastructureSystems.register_recorder(&lt;recorder-name&gt;)</code> for each recorder object you want to create.<ul><li>Depending on how often your code create events you may want to make this conditional. You may only need it for debug runs.</li><li>PowerSimulations creates one recorder for simulation step and stage start/stop events that is always enabled. It creates another that is optional but used for frequently-generated events.</li></ul></li><li>Call <code>@InfrastructureSystems.record &lt;recorder-name&gt; &lt;event&gt;</code> wherever you want to generate events in your code. The event will only get constructed if the recorder is registered.</li><li>Call <code>InfrastructureSystems.unregister_recorder(&lt;recorder-name&gt;)</code> for each registered recorder. You should guarantee this this gets called, even if an exception is thrown.  Otherwise, the file may not get flushed and closed.</li><li>After your code runs call <code>InfrastructureSystems.show_recorder_events</code> to view events.  Refer to the docstrings for more information.</li><li>Refer to <a href="https://nrel-siip.github.io/PowerSimulations.jl/latest/api/PowerSimulations/#PowerSimulations.show_simulation_events-Union{Tuple{T},%20Tuple{Type{T},AbstractString},%20Tuple{Type{T},AbstractString,Union{Nothing,%20Function}}}%20where%20T%3C:InfrastructureSystems.AbstractRecorderEvent">PowerSimulations.show<em>simulation</em>events</a> for an example on how to customize this behavior for your package.</li></ol></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../../">« Home</a><a class="docs-footer-nextpage" href="../../api/InfrastructureSystems/">InfrastructureSystems »</a></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> on <span class="colophon-date" title="Wednesday 15 July 2020 17:40">Wednesday 15 July 2020</span>. Using Julia version 1.3.0.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
